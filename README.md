# Football_SBM (2021)

This repository contains the data and code associated with the article/preprint by *F. Basini, V. Tsouli, I Ntzoufras, N. Friel*, 
*"Assessing competitive balance in the English Premier League for over forty seasons using a stochastic block model" (2021)*, currently deposited in [arXiv?].

## Repository structure:  

* ```README.md``` - you're reading it
* [/Data_Premier](https://github.com/basins95/Football_SBM/tree/master/Data_Premier) - contains the tables of results (match grids) of the Premier League championship from season 1977/78 to 2019/20 in csv format. e.g. *Result_Premier_0102.csv* for season 2001/02.
* [```LABEL_CORRECTION_AND_ANALYSIS.R```](https://github.com/basins95/Football_SBM/blob/master/LABEL_CORRECTION_AND_ANALYSIS.R): code to apply the label switching algorithm ([collpcm]) and carry out post-hoc analysis of the chain. 
* [```SBM_FUNCTIONS.R```](https://github.com/basins95/Football_SBM/blob/master/SBM_FUNCTIONS.R) contains all functions used in the MCMC algorithm. e.g. *get_loglik* returns the collapsed logllikelihood. 
* [```READ_TABLE_RESULTS.R```](https://github.com/basins95/Football_SBM/blob/master/READ_TABLE_RESULTS.R) code to load the result table and extract the relational pattern **y**.
* [```MCMC_main.R```](https://github.com/basins95/Football_SBM/blob/master/MCMC_main.R) the heart of the whole code which calls the other sources and runs the MCMC algorithm.
* [/Data_Premier](https://github.com/basins95/Football_SBM/tree/master/Data_Premier) - contains the tables of results (match grids) of the 

   * [```H-clustering.ipynb```](https://github.com/nestorsaiz/saiz-et-al_2020/blob/master/notebooks/H-clustering.ipynb) demonstrates the steps taken to classify ICM cells using Hierarchical Clustering 
   * [```Z-correction.ipynb```](https://github.com/nestorsaiz/saiz-et-al_2020/blob/master/notebooks/Z-correction.ipynb) compares raw with transformed data after correcting for fluorescence decay along the Z-axis
   * [```nanogata-tx.ipynb```](https://github.com/nestorsaiz/saiz-et-al_2020/blob/master/notebooks/nanogata-tx.ipynb) describes the conversion of NANOG and GATA6 intensitiy levels obtained with different antibodies to a common scale
* [/references](https://github.com/nestorsaiz/saiz-et-al_2020/tree/master/references) - contains the experimental reference files (metadata), generated manually as logs over the course of experimentation, as well as other reference files generated automatically during the analysis:
   * ```*_exp_ref.csv``` are files with experimental data for each experiment, such as experimental date, experimental group, etc
   * ```*_if.csv``` are files containing details about the antibodies used to stain the corresponding embryos in each experiment 
* [/src](https://github.com/nestorsaiz/saiz-et-al_2020/tree/master/src) - contains source code to use in the project
   * ```*_runall.R``` files run all steps in the pipeline for the corresponding dataset (read, transform, classify and count cells). 
   * ```plotting-aes.R``` sets up a few objects that are used in plots throughout the project.
   * ```setup.R``` loads the basic packages used in all scripts, runs ```plotting-aes.R``` and sets a seed for reproducibility.
   * /data - scripts that read in and transform data tables
      - ```*_read.R``` read in files in ```./data/corfiles```, combine them, clean them and count cells. Generate ```*-raw.csv``` files stored in ```./data/raw```.
      - ```*_tx.R``` apply transformations to data generated by ```*_read.R```. Generate ```*-tx.csv``` files stored in ```./data/interim```.
      - ```*_classify.R``` classify cells in ```*_tx.csv``` data tables into populations as necessary. Generate ```*-processed.csv``` files stored in ```./data/processed```.
      - ```*_counter.R``` count number of cells in each lineage in ```*-processed.csv``` data tables and writes them to ```./data/processed```. 
   * /functions - scripts defining functions used throughout analysis to perform data transformations, classification, etc.
   * /models - scripts that fit models to transform some of the data.
   * /visualization - scripts to generate the plots in the figures of the paper. Output files are stored in ```./figures```.

## Usage

Clone repository using ```git clone``` as usual. The file ```regdev_project.Rproj``` should allow you to open and run all scripts and functions and reproducibly generate data tables and figures. Packages are handled by [packrat](https://rstudio.github.io/packrat/) and the working directory by the .Rproj file. If you encounter any bug or issues please reach out.
